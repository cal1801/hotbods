<nav class="navbar navbar-light bg-light">
  <div>
    <a class="navbar-brand" href="#">HotBods</a>
    <%="Hello #{current_user.first_name}" if user_signed_in?%>
    <%#= link_to('Enter Weight', new_user_session_path)  %>
  </div>

  <div>
    <% if user_signed_in? %>
      <%#= link_to "Edit User", edit_user_registration_path %>
      <%= link_to 'Logout', destroy_user_session_path, method: :delete, style: "margin-left:30px" %>
    <% else %>
      <%= link_to 'Login', new_user_session_path, style: "margin-left:30px" %>
    <% end %>
  </div>
</nav>


<div class="container" style="margin-top: 30px">
  <div class="row">
    <div class="col-sm-4">
      <div class="card">
        <div class="card-header">
          Current Weights
        </div>
        <div class="card-block">
          <p class="card-text">
            <%@users.order(:id).each do |user|%>
              <%=user.first_name%> - <%=user.weight_data.last.try(:weight)%><br/>
            <%end%>
          </p>
        </div>
      </div>

      <% if user_signed_in?%>
        <div class="card" style="margin-top: 30px">
          <div class="card-header">
            Log Your Weight<br />
          </div>
          <div class="card-block">
            <%today = Date.today%>
            <%if today.all_week.cover?(current_user.weight_data.last.try(:created_at))%>
              <p class="card-text">
                You already have entered a weight for this week. Come back next monday!
              </p>
            <%else%>
              <%= form_for WeightDatum.new, url: {action: "create", controller: "weight_data"}, remote: true, class: "form-inline" do |f| %>
                <div class="form-group">
                  <%= f.label :weight %>
                  <%= f.text_field :weight, placeholder: "To the nearest 10th", class: "form-control" %>
                </div>

                <%=f.hidden_field :user_id, value: current_user.id%>

                <div class="actions">
                  <%= f.submit "Log Weight", class: "btn btn-primary"%>
                </div>
              <% end %>
            <%end%>
          </div>
        </div>
      <%end%>
    </div>
    <div class="col-sm-8">
      <div style="height: 30px" class="hidden-md-up"></div>
      <%= line_chart @users.map { |user| {name: user.first_name, data: @weight_data[user.id]}} %>
    </div>
  </div>
</div>
